# 初始选择功能测试文档

## 测试目的

验证初始选择功能的完整性和正确性，确保：
1. 新用户能正确进入初始选择流程
2. 不同身份选择能正确初始化资源配置
3. 老用户能跳过初始选择直接进入游戏
4. 数据能正确保存和加载

---

## 测试环境准备

### 方式1：使用测试脚本（推荐）

#### 步骤：
1. 打开Unity项目
2. 打开GameScene场景
3. 在Hierarchy中创建空GameObject，命名为"InitialSelectionTest"
4. 将 `InitialSelectionTest.cs` 脚本挂载到该对象上
5. 在Inspector中勾选 "Enable Test Mode"
6. 运行游戏

#### 测试方式：
- 按数字键1-6执行不同的测试
- 查看Console输出的详细日志
- 在屏幕左上角查看测试说明UI

### 方式2：完整UI测试

#### 步骤：
1. 按照 `INITIAL_SELECTION_GUIDE.md` 创建完整的UI
2. 确保所有UI引用正确连接
3. 运行游戏并测试完整流程

---

## 测试用例

### 测试用例1：新用户 - 脑机连接者

**测试目标**：验证新用户选择脑机连接者时的资源初始化

**前置条件**：
- 用户数据的 hasCreatedCharacter = false
- 或使用全新的测试账号

**测试步骤**：
1. 启动游戏
2. 登录（或使用测试脚本按键1）
3. 观察是否显示初始选择界面
4. 选择"脑机连接者"选项
5. 点击"确认选择"按钮

**预期结果**：
```
✓ 显示初始选择界面
✓ 显示脑机连接者详细信息
✓ 确认按钮可点击
✓ Console输出：选择：脑机连接者
✓ Console输出：确认选择：ConsciousnessLinker
✓ ResourceManager初始化以下配置：
   - 内存：16GB（已用2GB，可用14GB）
   - CPU：8核（已用1核，可用7核）
   - 网速：1000Mbps（已用50Mbps，可用950Mbps）
   - 算力：100（已用10，可用90）
   - 存储：500GB（已用20GB，可用480GB）
   - 数据生成速率：0.5GB/5分钟
✓ hasCreatedCharacter设置为true
✓ identityType设置为0
✓ 进入游戏场景
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例2：新用户 - 纯虚拟人

**测试目标**：验证新用户选择纯虚拟人时的资源初始化

**前置条件**：
- 用户数据的 hasCreatedCharacter = false
- 或使用全新的测试账号

**测试步骤**：
1. 启动游戏
2. 登录（或使用测试脚本按键2）
3. 观察是否显示初始选择界面
4. 选择"纯虚拟人"选项
5. 点击"确认选择"按钮

**预期结果**：
```
✓ 显示初始选择界面
✓ 显示纯虚拟人详细信息
✓ 确认按钮可点击
✓ Console输出：选择：纯虚拟人
✓ Console输出：确认选择：FullVirtual
✓ ResourceManager初始化以下配置：
   - 内存：16GB（已用4GB，可用12GB）
   - CPU：8核（已用2核，可用6核）
   - 网速：1000Mbps（已用100Mbps，可用900Mbps）
   - 算力：100（已用20，可用80）
   - 存储：500GB（已用50GB，可用450GB）
   - 数据生成速率：1.2GB/5分钟
✓ hasCreatedCharacter设置为true
✓ identityType设置为1
✓ 进入游戏场景
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例3：老用户流程

**测试目标**：验证已创建角色的用户能跳过初始选择

**前置条件**：
- 用户数据的 hasCreatedCharacter = true
- 或先执行测试用例1或2，然后重新登录

**测试步骤**：
1. 完成测试用例1或2
2. 重启游戏
3. 使用相同账号登录（或使用测试脚本按键3）

**预期结果**：
```
✓ 不显示初始选择界面
✓ Console输出：欢迎回来！加载用户数据...
✓ 直接进入游戏场景
✓ 资源配置保持之前选择的配置
✓ hasCreatedCharacter保持为true
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例4：选择切换

**测试目标**：验证在确认前可以切换选择

**前置条件**：
- 显示初始选择界面

**测试步骤**：
1. 启动游戏，进入初始选择界面
2. 点击"脑机连接者"按钮
3. 观察显示的信息
4. 点击"纯虚拟人"按钮
5. 观察显示的信息
6. 再次点击"脑机连接者"按钮

**预期结果**：
```
✓ 第一次点击后显示脑机连接者信息
✓ 确认按钮启用
✓ 第二次点击后：
   - 脑机连接者信息隐藏
   - 纯虚拟人信息显示
   - 确认按钮保持启用
✓ 第三次点击后：
   - 纯虚拟人信息隐藏
   - 脑机连接者信息显示
   - 确认按钮保持启用
✓ 按钮有视觉反馈（颜色变化）
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例5：确认按钮初始状态

**测试目标**：验证确认按钮初始禁用

**前置条件**：
- 显示初始选择界面

**测试步骤**：
1. 启动游戏，进入初始选择界面
2. 观察确认按钮状态
3. 尝试点击确认按钮

**预期结果**：
```
✓ 确认按钮初始为禁用状态（灰色）
✓ 点击无反应
✓ 选择任一身份后，按钮变为可点击状态
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例6：数据持久化

**测试目标**：验证选择结果能正确保存

**前置条件**：
- 完成初始选择

**测试步骤**：
1. 完成初始选择（选择任一身份）
2. 使用测试脚本按键6查看用户数据
3. 重启游戏
4. 使用测试脚本按键6再次查看用户数据

**预期结果**：
```
✓ 第一次查看：
   - hasCreatedCharacter = true
   - identityType = 选择的身份类型
✓ 重启后查看：
   - 数据与第一次相同
   - 没有丢失
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例7：资源配置验证

**测试目标**：验证两种身份的资源配置差异

**前置条件**：
- 使用测试脚本

**测试步骤**：
1. 运行游戏
2. 按键1选择脑机连接者
3. 按键5查看资源配置
4. 按键4重置数据
5. 按键2选择纯虚拟人
6. 按键5查看资源配置
7. 对比两次的资源配置

**预期结果**：
```
脑机连接者配置：
✓ 内存已用：2GB
✓ CPU已用：1核
✓ 网速已用：50Mbps
✓ 算力已用：10
✓ 存储已用：20GB
✓ 数据生成：0.5GB/5分钟

纯虚拟人配置：
✓ 内存已用：4GB
✓ CPU已用：2核
✓ 网速已用：100Mbps
✓ 算力已用：20
✓ 存储已用：50GB
✓ 数据生成：1.2GB/5分钟

配置差异符合设计文档
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

### 测试用例8：事件系统

**测试目标**：验证事件系统正确触发

**前置条件**：
- 能够监听Console日志

**测试步骤**：
1. 运行游戏
2. 完成初始选择流程
3. 观察Console输出

**预期结果**：
```
✓ Console输出事件序列：
   1. "选择：[身份类型]"
   2. "确认选择：[身份类型]"
   3. "玩家完成初始选择：[身份类型]"
   4. "完成角色创建，身份类型：[身份类型]"
   5. "选择身份类型：[身份类型]"
   6. ResourceManager.OnResourcesChanged事件触发
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

**问题记录**：（如有）

---

## 性能测试

### 测试用例9：内存占用

**测试目标**：验证功能不会造成内存泄漏

**测试步骤**：
1. 运行游戏
2. 记录初始内存占用
3. 执行10次完整的新用户流程（使用测试脚本按键4重置）
4. 记录最终内存占用

**预期结果**：
```
✓ 内存增长 < 50MB
✓ 没有明显的内存泄漏
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

### 测试用例10：响应速度

**测试目标**：验证UI响应速度

**测试步骤**：
1. 运行游戏
2. 进入初始选择界面
3. 快速点击两个身份按钮（交替点击）
4. 点击确认按钮

**预期结果**：
```
✓ 按钮点击响应即时（< 100ms）
✓ 信息面板切换流畅
✓ 确认后场景切换快速（< 1秒）
✓ 没有卡顿或延迟
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

## 边界测试

### 测试用例11：重复确认

**测试目标**：验证防止重复确认

**测试步骤**：
1. 进入初始选择界面
2. 选择一个身份
3. 快速多次点击确认按钮

**预期结果**：
```
✓ 只触发一次确认流程
✓ 不会重复初始化资源
✓ 不会重复设置hasCreatedCharacter
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

### 测试用例12：缺少引用处理

**测试目标**：验证缺少UI引用时的错误处理

**测试步骤**：
1. 在InitialSelectionUI中故意留空某些UI引用
2. 运行游戏
3. 观察Console输出

**预期结果**：
```
✓ Console输出警告信息（而非错误）
✓ 游戏不会崩溃
✓ 能够正确处理null引用
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

## 集成测试

### 测试用例13：与ResourceManager集成

**测试目标**：验证与ResourceManager的正确集成

**测试步骤**：
1. 完成初始选择
2. 检查ResourceManager的playerIdentity字段
3. 检查ResourceManager的playerResources字段
4. 验证资源配置是否正确

**预期结果**：
```
✓ playerIdentity正确设置
✓ playerResources正确初始化
✓ 可用资源计算正确
✓ 资源使用率计算正确
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

### 测试用例14：与GameManager集成

**测试目标**：验证与GameManager的正确集成

**测试步骤**：
1. 观察GameManager的状态变化
2. 完成初始选择
3. 验证GameManager正确切换到MainGame状态

**预期结果**：
```
✓ 新用户登录后GameManager进入CharacterCreation状态
✓ 完成选择后GameManager进入MainGame状态
✓ 老用户登录后GameManager直接进入MainGame状态
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

## 回归测试

### 测试用例15：不影响现有功能

**测试目标**：验证新功能不影响现有系统

**测试步骤**：
1. 完成初始选择
2. 测试工作系统
3. 测试技能系统
4. 测试资源系统
5. 测试其他已有功能

**预期结果**：
```
✓ 所有现有功能正常工作
✓ 没有引入新的Bug
✓ 资源管理器正常工作
✓ 其他管理器正常工作
```

**实际结果**：（填写）

**测试状态**：[ ] 通过 [ ] 失败

---

## 测试总结

### 测试统计

- **总测试用例数**：15
- **通过数量**：_____
- **失败数量**：_____
- **跳过数量**：_____
- **通过率**：_____%

### 主要问题

1. （列出测试中发现的主要问题）
2. 
3. 

### 修复建议

1. （针对问题提出修复建议）
2. 
3. 

### 测试结论

[ ] **通过**：所有核心测试用例通过，功能可以发布
[ ] **有保留通过**：大部分测试通过，但有次要问题需要修复
[ ] **不通过**：存在严重问题，需要修复后重新测试

---

## 测试签名

**测试人员**：_________________  
**测试日期**：_________________  
**测试环境**：Unity版本 _______, 操作系统 _______  

---

**《电子公民》开发团队**  
测试文档版本：v1.0
